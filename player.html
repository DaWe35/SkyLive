<style>
    body {
        margin: 0;
    }
    video {
        width: 100%;
        display: inline-block;
    }

    #player2 {
        display: none;
    }

    #counter {
        display: none;
    }

    /* DEV MODE */
    body.devmode {
        background-color: rgb(92, 96, 99);
    }

    .devmode video {
        width: 50%;
    }

    .devmode #player2, body.devmode #player1 {
        display: inline-block !important;
    }

    .devmode #counter {
        display: inherit;
    }
</style>

<video id="player1" src="noisecopy/0.mp4" controls preload></video><!--

--><video id="player2" src="noisecopy/1.mp4" controls preload></video>

<button onclick="switchDevMode()">Dev mode</button>

<p id="counter">asd</p>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

<script>
    let switchWindow = 0.1

    var queue = [];
    var socket = new WebSocket("ws://localhost:8080");
    startPush = 0
    socket.onmessage = function (event) {
        console.log('websocket: ' + event.data)
        queue.push(event.data);
        startPush += 1
        if (startPush == 2) {
            vid1.src = queue.shift()
            vid2.src = queue.shift()
        }
    }


    let vid1 = document.getElementById("player1")
    let vid2 = document.getElementById("player2")
    currentPlayer = 1
    devmode = 0

    function switchPlayer() {
        if (queue.length == 0) {
            vid1.pause()
            vid2.pause()
            return
        }
        if (currentPlayer == 1) {
            vid2.play()
            setTimeout(function(){
                vid1.src = queue.shift()
            }, 1000);
            setTimeout(function(){
                vid2.style.display = 'inline-block'
                vid1.style.display = 'none'
            }, switchWindow-10);
            currentPlayer = 2
        } else {
            vid1.play()
            setTimeout(function(){
                vid2.src = queue.shift()
            }, 1000);
            setTimeout(function(){
                vid1.style.display = 'inline-block'
                vid2.style.display = 'none'
            }, switchWindow-10);
            currentPlayer = 1
        }
    }


    const interval = setInterval(function() {
        if (currentPlayer == 1) {
            player = vid1
        } else {
            player = vid2
        }
        
        remain = player.duration - player.currentTime
        if (remain <= switchWindow) {
            switchPlayer()
        }

        if (devmode) {
            remRound = Math.round(remain * 1000) / 1000
            $('#asd').html(remRound)
        }
    }, 10);

    function switchDevMode() {
        if (devmode == 0) {
            $('body').addClass('devmode')
            devmode = 1;
        } else {
            $('body').removeClass('devmode')
            devmode = 0;
        }
    }

</script>